<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于ijkplayer、百度视频播放器SDK打造简单的应用内播放页面，支持手势，module可直接使用 | 阿富的笔记本</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Android 安卓 miniprogram 小程序 Html Css Javascript">
    
    <link rel="preload" href="/assets/css/0.styles.460a1adf.css" as="style"><link rel="preload" href="/assets/js/app.67f31782.js" as="script"><link rel="preload" href="/assets/js/2.4b79b7dc.js" as="script"><link rel="preload" href="/assets/js/3.4487d2a3.js" as="script"><link rel="prefetch" href="/assets/js/10.c6c178b6.js"><link rel="prefetch" href="/assets/js/11.29d1fe38.js"><link rel="prefetch" href="/assets/js/12.1096197c.js"><link rel="prefetch" href="/assets/js/13.7dcb0591.js"><link rel="prefetch" href="/assets/js/14.74441acb.js"><link rel="prefetch" href="/assets/js/15.e253b149.js"><link rel="prefetch" href="/assets/js/16.cb366f0a.js"><link rel="prefetch" href="/assets/js/17.3fce5bda.js"><link rel="prefetch" href="/assets/js/18.9baa81ec.js"><link rel="prefetch" href="/assets/js/19.7e699f3c.js"><link rel="prefetch" href="/assets/js/20.69b9ebc0.js"><link rel="prefetch" href="/assets/js/21.fea2c0c8.js"><link rel="prefetch" href="/assets/js/22.786e363d.js"><link rel="prefetch" href="/assets/js/4.ef6e4a50.js"><link rel="prefetch" href="/assets/js/5.eae85225.js"><link rel="prefetch" href="/assets/js/6.f67fb97d.js"><link rel="prefetch" href="/assets/js/7.8f502614.js"><link rel="prefetch" href="/assets/js/8.b840a4aa.js"><link rel="prefetch" href="/assets/js/9.2998da34.js">
    <link rel="stylesheet" href="/assets/css/0.styles.460a1adf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/bigHero.png" alt="阿富的笔记本" class="logo"> <span class="site-name can-hide">阿富的笔记本</span></a> <div class="links"><!----> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Android</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/android/note.html" class="sidebar-link">Android开发(持续更新)</a></li><li><a href="/android/player-ijkplayer.html" aria-current="page" class="active sidebar-link">视频播放（基于ijkplayer）</a></li><li><a href="/android/intent-share-filter.html" class="sidebar-link">Intent分享，按需要过滤</a></li><li><a href="/android/intent-open-youtube.html" class="sidebar-link">Intent打开Youtube并带入搜索关键字</a></li><li><a href="/android/ble-tether-1.html" class="sidebar-link">【BLE】蓝牙「防丢器」（一）</a></li><li><a href="/android/ble-tether-2.html" class="sidebar-link">【BLE】蓝牙「防丢器」（二）</a></li><li><a href="/android/ble-tether-3.html" class="sidebar-link">【BLE】蓝牙「防丢器」（三）</a></li><li><a href="/android/trivia-smb-browse.html" class="sidebar-link">【冷知识】SMB浏览</a></li><li><a href="/android/trivia-smb-http.html" class="sidebar-link">【冷知识】SMB转Http协议</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>微信小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miniprogram/note.html" class="sidebar-link">小程序开发(持续更新)</a></li><li><a href="/miniprogram/watermark.html" class="sidebar-link">页面添加水印，防止截图</a></li><li><a href="/miniprogram/plugins-handwriting.html" class="sidebar-link">小程序插件-手写签名</a></li><li><a href="/miniprogram/plugins-calendar.html" class="sidebar-link">小程序插件-日历</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Html相关</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基于ijkplayer、百度视频播放器sdk打造简单的应用内播放页面-支持手势-module可直接使用"><a href="#基于ijkplayer、百度视频播放器sdk打造简单的应用内播放页面-支持手势-module可直接使用" class="header-anchor">#</a> 基于ijkplayer、百度视频播放器SDK打造简单的应用内播放页面，支持手势，module可直接使用</h1> <p><a href="https://github.com/AFAP/Player" target="_blank" rel="noopener noreferrer">完整Module的Github地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>【2017.10.27更新：加入ijkplay的module，.so文件是自己编译的可以支持更多的格式。具体如何调用，看app主界面测试的代码】</p> <p>在开发一些应用时，我们需要实现视频的播放（本地或者网络的），在没有特殊要求的情况下，我们可以利用第三方SDK来实现一个简易的播放页面。这么做的目的，主要就是为了实现使用体验的统一，避免用户手机上已有的播放器各异导致的各种问题。
　　本文就是介绍如何利用百度的Android播放器SDK来打造一个属于自己的播放器，原则上你可以上网找其他的也行。自定义的功能主要有：1.实现简易的时长、进度显示；2.实现横向划屏来快进、快退；3.左侧屏幕上下划屏来实现亮度控制；4.右侧屏幕上下划屏实现音量控制。</p> <p><img src="/assets/img/1.e09444e8.png" alt="整体效果"></p> <h2 id="_1-简单说明"><a href="#_1-简单说明" class="header-anchor">#</a> 1.简单说明</h2> <ul><li><p>使用的库：<strong>[<a href="https://bce.baidu.com/doc/Downloadcenter/player.html#.E6.92.AD.E6.94.BE.E5.99.A8.20Android.20SDK" target="_blank" rel="noopener noreferrer">百度播放器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ](https://cloud.baidu.com/doc/MCT/Android-SDK.html#.E7.89.88.E6.9C.AC.E6.9B.B4.E6.96.B0.E8.AE.B0.E5.BD.95)</strong>、<strong><a href="https://github.com/Bilibili/ijkplayer" target="_blank" rel="noopener noreferrer">IJK播放器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p></li> <li><p>使用到的资源，我实在记不得了，当时也是广撒网找了好多个，最后忘记用的哪个的了，本文就是融合总结。</p></li> <li><p>我试了很多库，最终才确定用的百度的，主要原因是使用简单，稳定，兼容格式多，还能播放http等网络视频流。我试过的几个库，我也简单说下：
1.<strong><a href="https://github.com/yixia/VitamioBundle/" target="_blank" rel="noopener noreferrer">vitamio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>：这个是我一开始用的，且使用了一段时间，特点是集成难度一般，用的人比较多，兼容格式也多，但是当时放弃的一个主要原因是不支持ARM64，而用户有这些手机……
2.<strong><a href="https://github.com/SinaVDDeveloper/sinavideo_playersdk" target="_blank" rel="noopener noreferrer">sinavideo_playersdk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>：这个是由原来Sina员工维护的，特点是自带界面比较舒服，缺点是员工已离职，没人维护了，使用会有坑！
3.<strong><a href="https://github.com/google/ExoPlayer" target="_blank" rel="noopener noreferrer">ExoPlayer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>：这个是谷歌亲爹出的，然而并不实用，特点是对视频流有很好的支持，引入很方便，缺点是本地视频支持的格式实在太少了，难道国外的视频全部是统一的mp4吗？</p></li></ul> <h2 id="_2-项目结构"><a href="#_2-项目结构" class="header-anchor">#</a> 2.项目结构</h2> <p>如下图所示，集成的播放页面被作为了一个单独的module，这样的好处就是完全独立，在主app内的主配置文件，记得加一下这个Acticity即可，提前说一下，在调用VideoPlayActivity时只需要传递一个参数url，该值可以是文件的全路径或者在线视频地址。
图中还有个注意点，就是bdplayer/libs下的jar和.so，根据自己的需要从下载的SDK中获取添加。</p> <p><img src="/assets/img/2.6fc6f409.png" alt="项目结构图"></p> <p>该module只有一个Activity，即播放页面；一个layout，以及若干图片资源文件。在该module的主配置文件<code>AndroidManifest.xml</code>中不需要多余设置。</p> <p>该module的<code>build.gradle</code>如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>apply plugin<span class="token operator">:</span> <span class="token string">'com.android.library'</span>

android <span class="token punctuation">{</span>
	compileSdkVersion <span class="token number">23</span>
	buildToolsVersion <span class="token string">&quot;23.0.2&quot;</span>

	defaultConfig <span class="token punctuation">{</span>
		minSdkVersion <span class="token number">14</span>
		targetSdkVersion <span class="token number">23</span>
		versionCode <span class="token number">116</span>
		versionName <span class="token string">&quot;1.16.0&quot;</span>
	<span class="token punctuation">}</span>
	sourceSets<span class="token punctuation">.</span>main <span class="token punctuation">{</span>
		jni<span class="token punctuation">.</span>srcDirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		jniLibs<span class="token punctuation">.</span>srcDir <span class="token string">'libs'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
	compile <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token string">'libs'</span><span class="token punctuation">,</span> include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*.jar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="_3-播放页面布局"><a href="#_3-播放页面布局" class="header-anchor">#</a> 3. 播放页面布局</h2> <p><img src="/assets/img/3.be88c841.png" alt="页面布局分析"></p> <p>从图中可以看出，整个页面主要包含以下几个id的View：
1.view_holder，充满整个屏幕，待添加播放器View；
2.touch_area，除底部进度位置外的全部区域，监听手势；这其中还包含app_video_center_box，该区域位于屏幕中央，用来显示进度、亮度、音量的值；
3.app_video_bottom_box，底部用来显示时长、进度、暂停、全屏的区域。</p> <h2 id="_4-实现播放器播放视频"><a href="#_4-实现播放器播放视频" class="header-anchor">#</a> 4.实现播放器播放视频</h2> <p>接下来进入Activity的编码部分了，这其中用到的关于播放器的API，详细的可以查看官网的文档。本项目也仅仅是用到了几个比较常用的方法。<strong>完整代码见最后。</strong>
首先，创建播放器BVideoView，并添加至view_holder中，然后对播放器进行一些基础配置设置，包括视频来源、是否显示缓冲信息（针对网络视频），播放器准备完毕事件、播放结束事件、播放出错等等一些监听。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_play_video<span class="token punctuation">)</span><span class="token punctuation">;</span>

	mVideoSource <span class="token operator">=</span> <span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">PowerManager</span> pm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PowerManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>POWER_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mWakeLock <span class="token operator">=</span> pm<span class="token punctuation">.</span><span class="token function">newWakeLock</span><span class="token punctuation">(</span><span class="token class-name">PowerManager</span><span class="token punctuation">.</span>FULL_WAKE_LOCK <span class="token operator">|</span> <span class="token class-name">PowerManager</span><span class="token punctuation">.</span>ON_AFTER_RELEASE<span class="token punctuation">,</span> TAG<span class="token punctuation">)</span><span class="token punctuation">;</span>

	audioManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>AUDIO_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mMaxVolume <span class="token operator">=</span> audioManager<span class="token punctuation">.</span><span class="token function">getStreamMaxVolume</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">)</span><span class="token punctuation">;</span>

	mViewHolder <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RelativeLayout</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>view_holder<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">BVideoView</span><span class="token punctuation">.</span><span class="token function">setAK</span><span class="token punctuation">(</span><span class="token string">&quot;xxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BVideoView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mViewHolder<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>mVV<span class="token punctuation">)</span><span class="token punctuation">;</span>

	mVV<span class="token punctuation">.</span><span class="token function">setOnPreparedListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV<span class="token punctuation">.</span><span class="token function">setOnCompletionListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV<span class="token punctuation">.</span><span class="token function">setOnCompletionWithParamListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV<span class="token punctuation">.</span><span class="token function">setOnErrorListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV<span class="token punctuation">.</span><span class="token function">setOnInfoListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV<span class="token punctuation">.</span><span class="token function">setOnPlayingBufferCacheListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	mVV<span class="token punctuation">.</span><span class="token function">setDecodeMode</span><span class="token punctuation">(</span><span class="token class-name">BVideoView</span><span class="token punctuation">.</span>DECODE_SW<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV<span class="token punctuation">.</span><span class="token function">showCacheInfo</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mVV<span class="token punctuation">.</span><span class="token function">setVideoPath</span><span class="token punctuation">(</span>mVideoSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

	$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	seekBar <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SeekBar</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_seekBar<span class="token punctuation">)</span><span class="token punctuation">;</span>
	seekBar<span class="token punctuation">.</span><span class="token function">setOnSeekBarChangeListener</span><span class="token punctuation">(</span>mSeekListener<span class="token punctuation">)</span><span class="token punctuation">;</span>

	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_play<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clicked</span><span class="token punctuation">(</span>onClickListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_fullscreen<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clicked</span><span class="token punctuation">(</span>onClickListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_replay_icon<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clicked</span><span class="token punctuation">(</span>onClickListener<span class="token punctuation">)</span><span class="token punctuation">;</span>

	portrait <span class="token operator">=</span> <span class="token function">getScreenOrientation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ActivityInfo</span><span class="token punctuation">.</span>SCREEN_ORIENTATION_PORTRAIT<span class="token punctuation">;</span>

	screenWidthPixels <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>widthPixels<span class="token punctuation">;</span>

	<span class="token function">onPrepared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPrepared</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	duration <span class="token operator">=</span> mVV<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token class-name">GestureDetector</span> gestureDetector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GestureDetector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PlayerGestureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mRoot <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>touch_area<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mRoot<span class="token punctuation">.</span><span class="token function">setClickable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mRoot<span class="token punctuation">.</span><span class="token function">setOnTouchListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnTouchListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> motionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>gestureDetector<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>motionEvent<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

			<span class="token comment">// 处理手势结束</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span>motionEvent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP<span class="token operator">:</span>
					<span class="token function">endGesture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	mVV<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>通过以上代码，就可以实现视频的播放了（先不要看触摸事件监听等等啦，通过核心的几行设置，就能看视频了）。Activity需要实现OnPreparedListener, OnCompletionListener, OnErrorListener, OnInfoListener, OnPlayingBufferCacheListener,  OnCompletionWithParamListener对应的方法，各个方法的功能，根据方法名称应该就能知道的差不多了。</p> <h2 id="_5-实现底部时长、进度、暂停-播放的显示与控制"><a href="#_5-实现底部时长、进度、暂停-播放的显示与控制" class="header-anchor">#</a> 5.实现底部时长、进度、暂停/播放的显示与控制</h2> <p><img src="/assets/img/4.e09444e8.png" alt="整体效果"></p> <p>如上图所示，播放时，影片的底部会显示暂停/播放按钮、当前时长、总时长、进度条以及全屏按钮。</p> <ul><li>1.捕获屏幕点击事件，对底部区域进行显隐操作（默认不点击屏幕是不显示底部的）
获取touch_area并设置触摸屏幕监听事件：setOnTouchListener.</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">GestureDetector</span> gestureDetector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GestureDetector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PlayerGestureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mRoot <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>touch_area<span class="token punctuation">)</span><span class="token punctuation">;</span>
mRoot<span class="token punctuation">.</span><span class="token function">setClickable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mRoot<span class="token punctuation">.</span><span class="token function">setOnTouchListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnTouchListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> motionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>gestureDetector<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>motionEvent<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

		<span class="token comment">// 处理手势结束</span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span>motionEvent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP<span class="token operator">:</span>
				<span class="token function">endGesture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerGestureListener</span> <span class="token keyword">extends</span> <span class="token class-name">GestureDetector<span class="token punctuation">.</span>SimpleOnGestureListener</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> firstTouch<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> volumeControl<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> toSeek<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 双击
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onDoubleTap</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            videoView.toggleAspectRatio();</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onDown</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		firstTouch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDown</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 滑动
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onScroll</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> e1<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> e2<span class="token punctuation">,</span> <span class="token keyword">float</span> distanceX<span class="token punctuation">,</span> <span class="token keyword">float</span> distanceY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">float</span> mOldX <span class="token operator">=</span> e1<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mOldY <span class="token operator">=</span> e1<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> deltaY <span class="token operator">=</span> mOldY <span class="token operator">-</span> e2<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> deltaX <span class="token operator">=</span> mOldX <span class="token operator">-</span> e2<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>firstTouch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			toSeek <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>distanceX<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>distanceY<span class="token punctuation">)</span><span class="token punctuation">;</span>
			volumeControl <span class="token operator">=</span> mOldX <span class="token operator">&gt;</span> screenWidthPixels <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>
			firstTouch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>toSeek<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">onProgressSlide</span><span class="token punctuation">(</span><span class="token operator">-</span>deltaX <span class="token operator">/</span> mRoot<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">float</span> percent <span class="token operator">=</span> deltaY <span class="token operator">/</span> mRoot<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>volumeControl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">onVolumeSlide</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token function">onBrightnessSlide</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onScroll</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> distanceX<span class="token punctuation">,</span> distanceY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onSingleTapUp</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">hide</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">show</span><span class="token punctuation">(</span>defaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">showBottomControl</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullScreenOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_fullscreen<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		isShowing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	handler<span class="token punctuation">.</span><span class="token function">sendEmptyMessage</span><span class="token punctuation">(</span>MESSAGE_SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	handler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>MESSAGE_FADE_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>timeout <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		handler<span class="token punctuation">.</span><span class="token function">sendMessageDelayed</span><span class="token punctuation">(</span>handler<span class="token punctuation">.</span><span class="token function">obtainMessage</span><span class="token punctuation">(</span>MESSAGE_FADE_OUT<span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showBottomControl</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> show<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_play<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visibility</span><span class="token punctuation">(</span>show <span class="token operator">?</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE <span class="token operator">:</span> <span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_currentTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visibility</span><span class="token punctuation">(</span>show <span class="token operator">?</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE <span class="token operator">:</span> <span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_endTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visibility</span><span class="token punctuation">(</span>show <span class="token operator">?</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE <span class="token operator">:</span> <span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_seekBar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visibility</span><span class="token punctuation">(</span>show <span class="token operator">?</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE <span class="token operator">:</span> <span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div><p>这里先不看滑动，就看点击屏幕后的动作，执行的是show(defaultTimeout)，在这个方法里执行了显示操作，并通过handler来实现达到一定时间后隐藏控件。其中$是自定义一个类，用来实现findViewById和setText等功能的。
BVideoView.setAK，这里需要去百度申请下key。</p> <ul><li><p>2.获取影片总时长、当前播放时点，并格式化展示：</p> <p>private int setProgress() {
if (isDragging) {
return 0;
}</p> <div class="language- extra-class"><pre><code>  int position = mVV.getCurrentPosition();
  int duration = mVV.getDuration();
  if (seekBar != null) {
  	if (duration &gt; 0) {
  		seekBar.setProgress((position * 100 / duration));
  	}
  }

  this.duration = duration;

  $.id(R.id.app_video_currentTime).text(generateTime(position));
  $.id(R.id.app_video_endTime).text(generateTime(this.duration));
  return position;
</code></pre></div><p>}</p> <p>private String generateTime(int time) {
int totalSeconds = time;
int seconds = totalSeconds % 60;
int minutes = (totalSeconds / 60) % 60;
int hours = totalSeconds / 3600;
return hours &gt; 0 ? String.format(&quot;%02d:%02d:%02d&quot;, hours, minutes, seconds) : String.format(&quot;%02d:%02d&quot;,
minutes, seconds);
}
这一步就比较简单了，通过播放器API获取影片的总时长和当前正在播放的时长，通过格式化方法，将值设置到对应的控件上。</p></li> <li><p>3.暂停/播放按钮功能的实现</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doPauseResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> STATUS_COMPLETED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_replay<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mVV<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mVV<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mVV<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">statusChange</span><span class="token punctuation">(</span>STATUS_PAUSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mVV<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		mVV<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mVV<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_play<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_stop_white_24dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_play<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_play_arrow_white_24dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>设置app_video_play控件的点击事件为doPauseResume(),该方法中会获取当前播放状态，如在播放则暂停，如已暂停，则开始播放。注意，在调用相关方法后，记得设置按钮对应状态的图片。</p> <ul><li>4.实现底部进度条的滑动控制事件</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SeekBar<span class="token punctuation">.</span>OnSeekBarChangeListener</span> mSeekListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeekBar<span class="token punctuation">.</span>OnSeekBarChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onProgressChanged</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> seekBar<span class="token punctuation">,</span> <span class="token keyword">int</span> progress<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fromUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fromUser<span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> newPosition <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>duration <span class="token operator">*</span> progress <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> time <span class="token operator">=</span> <span class="token function">generateTime</span><span class="token punctuation">(</span>newPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>instantSeeking<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mVV<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span>newPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_currentTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartTrackingTouch</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> seekBar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		isDragging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token function">show</span><span class="token punctuation">(</span><span class="token number">3600000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		handler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>MESSAGE_SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>instantSeeking<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			audioManager<span class="token punctuation">.</span><span class="token function">setStreamMute</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStopTrackingTouch</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> seekBar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instantSeeking<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mVV<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>duration <span class="token operator">*</span> seekBar<span class="token punctuation">.</span><span class="token function">getProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">show</span><span class="token punctuation">(</span>defaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
		handler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>MESSAGE_SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		audioManager<span class="token punctuation">.</span><span class="token function">setStreamMute</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		isDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		handler<span class="token punctuation">.</span><span class="token function">sendEmptyMessageDelayed</span><span class="token punctuation">(</span>MESSAGE_SHOW_PROGRESS<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>这个就是根据当前seekbar的定位，来计算进度百分比，然后计算得到对应的影片时长，再调用播放器设置到对应的时点。此处需要注意的是onProgressChanged方法中，需要判断该变化来自用户手动操作还是系统方法，只有用户主动操作的，才需要后续动作。</p> <h2 id="_6-手势操作"><a href="#_6-手势操作" class="header-anchor">#</a> 6.手势操作</h2> <p>在这里，我们首先要捕获手势，并根据X/Y方向的位移来区分出用户的操作：左右划屏、上下划屏，同时上下划屏时还要判断出是在屏幕左侧还是右侧。</p> <p>这里我们主要看下手势事件里的onScroll方法的实现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onScroll</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> e1<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> e2<span class="token punctuation">,</span> <span class="token keyword">float</span> distanceX<span class="token punctuation">,</span> <span class="token keyword">float</span> distanceY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">float</span> mOldX <span class="token operator">=</span> e1<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mOldY <span class="token operator">=</span> e1<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> deltaY <span class="token operator">=</span> mOldY <span class="token operator">-</span> e2<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> deltaX <span class="token operator">=</span> mOldX <span class="token operator">-</span> e2<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>firstTouch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		toSeek <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>distanceX<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>distanceY<span class="token punctuation">)</span><span class="token punctuation">;</span>
		volumeControl <span class="token operator">=</span> mOldX <span class="token operator">&gt;</span> screenWidthPixels <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>
		firstTouch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>toSeek<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">onProgressSlide</span><span class="token punctuation">(</span><span class="token operator">-</span>deltaX <span class="token operator">/</span> mRoot<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">float</span> percent <span class="token operator">=</span> deltaY <span class="token operator">/</span> mRoot<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>volumeControl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">onVolumeSlide</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">onBrightnessSlide</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onScroll</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> distanceX<span class="token punctuation">,</span> distanceY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>代码不难理解，首先计算在X和Y方向的绝对位移，若X大，则表示是横向的手势，对应操作是快退和快进；若Y大，则表示是纵向手势，此时需要判断x的起点是否比屏幕宽度的一半大，如大于半个屏幕，则是在右侧的操作，对应声音调节，如小于半个屏幕，则是左侧操作，对应亮度调节。</p> <ul><li>1.左/右划屏实现快退/快进</li></ul> <p><img src="/assets/img/5.9690da68.png" alt="手势操作-快进快退"></p> <p>识别出手势后，接下来就简单了：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onProgressSlide</span><span class="token punctuation">(</span><span class="token keyword">float</span> percent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> position <span class="token operator">=</span> mVV<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> duration <span class="token operator">=</span> mVV<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> deltaMax <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> duration <span class="token operator">-</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> delta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>deltaMax <span class="token operator">*</span> percent<span class="token punctuation">)</span><span class="token punctuation">;</span>

	newPosition <span class="token operator">=</span> delta <span class="token operator">+</span> position<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>newPosition <span class="token operator">&gt;</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		newPosition <span class="token operator">=</span> duration<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newPosition <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		newPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		delta <span class="token operator">=</span> <span class="token operator">-</span>position<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> showDelta <span class="token operator">=</span> delta<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>showDelta <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_fastForward_box<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> text <span class="token operator">=</span> showDelta <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">&quot;+&quot;</span> <span class="token operator">+</span> showDelta<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> showDelta<span class="token punctuation">;</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_fastForward<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>text <span class="token operator">+</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_fastForward_target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">generateTime</span><span class="token punctuation">(</span>newPosition<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_fastForward_all<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">generateTime</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>在计算出快退和快进的步长后，还需要在屏幕中间显示告知用户目标步长等信息。</p> <ul><li>2.亮度调节</li></ul> <p><img src="/assets/img/6.8b379c19.png" alt="手势操作-亮度调节"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 滑动改变亮度
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onBrightnessSlide</span><span class="token punctuation">(</span><span class="token keyword">float</span> percent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>brightness <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		brightness <span class="token operator">=</span> <span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>screenBrightness<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>brightness <span class="token operator">&lt;=</span> <span class="token number">0.00f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			brightness <span class="token operator">=</span> <span class="token number">0.50f</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>brightness <span class="token operator">&lt;</span> <span class="token number">0.01f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			brightness <span class="token operator">=</span> <span class="token number">0.01f</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_brightness_box<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> lpa <span class="token operator">=</span> <span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	lpa<span class="token punctuation">.</span>screenBrightness <span class="token operator">=</span> brightness <span class="token operator">+</span> percent<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>lpa<span class="token punctuation">.</span>screenBrightness <span class="token operator">&gt;</span> <span class="token number">1.0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		lpa<span class="token punctuation">.</span>screenBrightness <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>lpa<span class="token punctuation">.</span>screenBrightness <span class="token operator">&lt;</span> <span class="token number">0.01f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		lpa<span class="token punctuation">.</span>screenBrightness <span class="token operator">=</span> <span class="token number">0.01f</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_brightness<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>lpa<span class="token punctuation">.</span>screenBrightness <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>lpa<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>根据位移百分比计算亮度，最后设置。</p> <ul><li>3.音量调节</li></ul> <p><img src="/assets/img/7.baffb653.png" alt="手势操作-音量调节"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 滑动改变声音大小
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onVolumeSlide</span><span class="token punctuation">(</span><span class="token keyword">float</span> percent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>volume <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		volume <span class="token operator">=</span> audioManager<span class="token punctuation">.</span><span class="token function">getStreamVolume</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>volume <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			volume <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">hide</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>percent <span class="token operator">*</span> mMaxVolume<span class="token punctuation">)</span> <span class="token operator">+</span> volume<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> mMaxVolume<span class="token punctuation">)</span>
		index <span class="token operator">=</span> mMaxVolume<span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">// 变更声音</span>
	audioManager<span class="token punctuation">.</span><span class="token function">setStreamVolume</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 变更进度条</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>index <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> mMaxVolume <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> s <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		s <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 显示</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_volume_icon<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_volume_off_white_36dp <span class="token operator">:</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable
			<span class="token punctuation">.</span>ic_volume_up_white_36dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_brightness_box<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_volume_box<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_volume_box<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	$<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_video_volume<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>同理，根据位移百分比来设置音量。</p> <h2 id="_7-如何使用"><a href="#_7-如何使用" class="header-anchor">#</a> 7.如何使用</h2> <p>首先如图，在app中猪配置文件加入该Activity：</p> <p><img src="/assets/img/8.92c98620.png" alt="注意红框处.png"></p> <p>然后，传入视频来源参数，并打开播放页：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">TutorialActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">VideoPlayActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>*<em>url可以是本地文件全路径，也可以是网络地址。记得在settings.gradle中引入module</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/android/note.html" class="prev">
        Android开发(持续更新)
      </a></span> <span class="next"><a href="/android/intent-share-filter.html">
        Intent分享，按需要过滤
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.67f31782.js" defer></script><script src="/assets/js/2.4b79b7dc.js" defer></script><script src="/assets/js/3.4487d2a3.js" defer></script>
  </body>
</html>
